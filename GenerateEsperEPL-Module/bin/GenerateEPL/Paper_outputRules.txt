@Name('Unlabeled') select * from UnlabeledEvent; 
@Name('Labeled') select * from LabeledEvent; 
@Name('Temp') select * from TempEvent ; 
@Name('get_case_ID')  insert into Cases  select (select coalesce(max(caseID)+1, 1)  from  Cases )  as caseID from UnlabeledEvent  where  activity in ('A');  
@Name('start_case_A')  insert into LabeledEvent (caseID, activity, timestamp, probability)  select (select coalesce(max(caseID)+1,1) from Cases) as caseID, UE.activity, UE.timestamp, 1.0  from UnlabeledEvent as UE where UE.activity = 'A'; 

@Priority(5) @Name('TE_B') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'B' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity='A' or activity='N')) -> every succ=UnlabeledEvent(activity='B') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_B') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'B'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_C') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'C' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'B')) -> every succ=UnlabeledEvent(activity='C') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_C') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'C'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_D') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'D' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'B')) -> every succ=UnlabeledEvent(activity='D') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=60000 ;
@Priority(20) @Name('Correlate_D') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'D'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_E') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'E' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity='D' or activity='H')) -> every succ=UnlabeledEvent(activity='E') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_E') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'E'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_F') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'F' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'E')) -> every succ=UnlabeledEvent(activity='F') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_F') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'F'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_G') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'G' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'E')) -> every succ=UnlabeledEvent(activity='G') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_G') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'G'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_H') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'H' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'F')) -> every succ=UnlabeledEvent(activity='H') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_H') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'H'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_I') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'I' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'C')) -> every succ=UnlabeledEvent(activity='I') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=90000 ;
@Priority(20) @Name('Correlate_I') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'I'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_J') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'J' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'C')) -> every succ=UnlabeledEvent(activity='J') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=90000 ;
@Priority(20) @Name('Correlate_J') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'J'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_L') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'L' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity='I') and every inter=LabeledEvent(activity='J')) -> every succ=UnlabeledEvent(activity='L') ]#time(30 sec)  where pred.caseID = inter.caseID and (succ.timestamp - max(pred.timestamp,inter.timestamp)) >= 1 and (succ.timestamp - max(pred.timestamp,inter.timestamp)) <=30000 ; 
@Priority(20) @Name('Correlate_L') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'L'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_M') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'M' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'L')) -> every succ=UnlabeledEvent(activity='M') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 1 and succ.timestamp - pred.timestamp <=30000 ;
@Priority(20) @Name('Correlate_M') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'M'  group by caseID order by timestamp; 

@Priority(5) @Name('TE_N') insert into TempEvent (caseID, activity, timestamp) select distinct pred.caseID, 'N' as activity, succ.timestamp as timestamp from pattern [(every pred=LabeledEvent(activity = 'L')) -> every succ=UnlabeledEvent(activity='N') ]#time(30 sec)  where succ.timestamp - pred.timestamp >= 2 and succ.timestamp - pred.timestamp <=50000 ;
@Priority(20) @Name('Correlate_N') insert into LabeledEvent (caseID, activity , timestamp, probability) select distinct caseID as caseID, last(activity) as activity, max(timestamp) as timestamp , ((select count(caseID)  from TempEvent.win:time_batch(1 sec) where caseID = T.caseID) /count(all caseID, group_by:timestamp)) as probability from TempEvent.win:time_batch(1 sec) as T  where activity = 'N'  group by caseID order by timestamp; 

